<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICCT Store - Debug Console</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        h1 { 
            color: #4ec9b0; 
            margin-bottom: 20px;
            border-bottom: 2px solid #4ec9b0;
            padding-bottom: 10px;
        }
        .console {
            background: #252526;
            border: 1px solid #3e3e42;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log { 
            padding: 5px 0;
            border-bottom: 1px solid #3e3e42;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #9cdcfe; }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover { background: #1177bb; }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            background: #252526;
            border: 2px solid #3e3e42;
            border-radius: 8px;
            padding: 15px;
        }
        .status-card.ok { border-color: #4ec9b0; }
        .status-card.fail { border-color: #f48771; }
        .status-title { 
            font-weight: bold; 
            margin-bottom: 10px;
            font-size: 16px;
        }
        .iframe-container {
            margin: 20px 0;
            border: 2px solid #3e3e42;
            border-radius: 8px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            background: white;
        }
    </style>
</head>
<body>
    <h1>üîç ICCT Store - Complete Diagnostic Tool</h1>
    
    <div class="status-grid" id="statusGrid">
        <div class="status-card" id="apiStatus">
            <div class="status-title">API Server</div>
            <div id="apiText">Checking...</div>
        </div>
        <div class="status-card" id="dbStatus">
            <div class="status-title">Database</div>
            <div id="dbText">Checking...</div>
        </div>
        <div class="status-card" id="frontendStatus">
            <div class="status-title">Frontend</div>
            <div id="frontendText">Checking...</div>
        </div>
        <div class="status-card" id="jsStatus">
            <div class="status-title">JavaScript</div>
            <div id="jsText">Checking...</div>
        </div>
    </div>

    <div>
        <button onclick="runFullDiagnostic()">üîÑ Run Full Diagnostic</button>
        <button onclick="testProducts('uniforms')">üëî Test Uniforms</button>
        <button onclick="testProducts('documents')">üìÑ Test Documents</button>
        <button onclick="testProducts('all-products')">üì¶ Test All Products</button>
        <button onclick="clearConsole()">üóëÔ∏è Clear Console</button>
        <button onclick="showMainSite()">üåê Show Main Site</button>
    </div>

    <div class="console" id="console"></div>

    <div class="iframe-container" id="iframeContainer" style="display: none;">
        <iframe id="siteFrame" src="about:blank"></iframe>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            const colors = {
                success: 'success',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };
            console.innerHTML += `<div class="log ${colors[type]}">[${time}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = '';
        }

        function showMainSite() {
            const container = document.getElementById('iframeContainer');
            const iframe = document.getElementById('siteFrame');
            iframe.src = '/index.html';
            container.style.display = 'block';
            log('üì± Loading main site in iframe...', 'info');
        }

        async function checkAPI() {
            try {
                const response = await fetch(`${API_URL}/?action=categories`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('apiStatus').className = 'status-card ok';
                    document.getElementById('apiText').innerHTML = `‚úÖ Online<br>Categories: ${data.data.length}`;
                    log(`‚úÖ API is working! Found ${data.data.length} categories`, 'success');
                    return true;
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('apiStatus').className = 'status-card fail';
                document.getElementById('apiText').innerHTML = `‚ùå Error<br>${error.message}`;
                log(`‚ùå API Error: ${error.message}`, 'error');
                return false;
            }
        }

        async function checkDatabase() {
            try {
                const response = await fetch(`${API_URL}/?action=products`);
                const data = await response.json();
                
                if (data.success) {
                    const count = data.data.length;
                    document.getElementById('dbStatus').className = 'status-card ok';
                    document.getElementById('dbText').innerHTML = `‚úÖ Connected<br>Products: ${count}`;
                    log(`‚úÖ Database has ${count} products`, 'success');
                    return count;
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                document.getElementById('dbStatus').className = 'status-card fail';
                document.getElementById('dbText').innerHTML = `‚ùå Error<br>${error.message}`;
                log(`‚ùå Database Error: ${error.message}`, 'error');
                return 0;
            }
        }

        async function checkFrontend() {
            try {
                const response = await fetch('/index.html');
                if (response.ok) {
                    document.getElementById('frontendStatus').className = 'status-card ok';
                    document.getElementById('frontendText').innerHTML = `‚úÖ Serving<br>Port: 8000`;
                    log('‚úÖ Frontend server is responding', 'success');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('frontendStatus').className = 'status-card fail';
                document.getElementById('frontendText').innerHTML = `‚ùå Error<br>${error.message}`;
                log(`‚ùå Frontend Error: ${error.message}`, 'error');
                return false;
            }
        }

        async function checkJavaScript() {
            try {
                const response = await fetch('/script.js');
                const text = await response.text();
                
                const hasAPIURL = text.includes('API_BASE_URL');
                const hasLoadProducts = text.includes('loadProducts');
                const hasRenderProducts = text.includes('renderProducts');
                
                if (hasAPIURL && hasLoadProducts && hasRenderProducts) {
                    document.getElementById('jsStatus').className = 'status-card ok';
                    document.getElementById('jsText').innerHTML = `‚úÖ Valid<br>Functions: OK`;
                    log('‚úÖ JavaScript has all required functions', 'success');
                    return true;
                } else {
                    document.getElementById('jsStatus').className = 'status-card fail';
                    document.getElementById('jsText').innerHTML = `‚ö†Ô∏è Warning<br>Missing functions`;
                    log('‚ö†Ô∏è JavaScript might be incomplete', 'warning');
                    return false;
                }
            } catch (error) {
                document.getElementById('jsStatus').className = 'status-card fail';
                document.getElementById('jsText').innerHTML = `‚ùå Error<br>${error.message}`;
                log(`‚ùå JavaScript Error: ${error.message}`, 'error');
                return false;
            }
        }

        async function testProducts(category) {
            log(`\nüì¶ Testing category: ${category}`, 'info');
            
            try {
                const url = `${API_URL}/?action=products&category=${category}`;
                log(`üîó Fetching: ${url}`, 'info');
                
                const response = await fetch(url);
                log(`üì° Response: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const count = data.data.length;
                    log(`‚úÖ SUCCESS! Got ${count} products`, 'success');
                    
                    if (count > 0) {
                        log(`üìã First 3 products:`, 'info');
                        data.data.slice(0, 3).forEach((p, i) => {
                            log(`  ${i+1}. ${p.name} - ‚Ç±${p.price}`, 'info');
                        });
                    }
                    
                    return data.data;
                } else {
                    log(`‚ùå API returned error: ${data.error}`, 'error');
                    return [];
                }
            } catch (error) {
                log(`‚ùå Fetch failed: ${error.message}`, 'error');
                return [];
            }
        }

        async function runFullDiagnostic() {
            clearConsole();
            log('üöÄ Starting full diagnostic...', 'info');
            log('‚îÄ'.repeat(60), 'info');
            
            log('\n1Ô∏è‚É£ Checking API Server...', 'warning');
            const apiOk = await checkAPI();
            
            log('\n2Ô∏è‚É£ Checking Database...', 'warning');
            const productCount = await checkDatabase();
            
            log('\n3Ô∏è‚É£ Checking Frontend Server...', 'warning');
            const frontendOk = await checkFrontend();
            
            log('\n4Ô∏è‚É£ Checking JavaScript...', 'warning');
            const jsOk = await checkJavaScript();
            
            log('\n' + '‚îÄ'.repeat(60), 'info');
            
            if (apiOk && productCount > 0 && frontendOk && jsOk) {
                log('\n‚úÖ ALL SYSTEMS OPERATIONAL!', 'success');
                log('üí° Your website should work perfectly', 'success');
                log('üîó Open: http://localhost:8000/index.html', 'info');
                log('üìã Click Shop ‚Üí Uniforms to see products', 'info');
                log('', 'info');
                log('‚ö†Ô∏è If products still don\'t show:', 'warning');
                log('   1. Clear browser cache (Ctrl+Shift+Delete)', 'warning');
                log('   2. Hard refresh (Ctrl+Shift+R)', 'warning');
                log('   3. Check browser console (F12) for errors', 'warning');
            } else {
                log('\n‚ùå SOME ISSUES DETECTED!', 'error');
                log('Please check the status cards above', 'error');
            }
        }

        // Auto-run diagnostic on load
        window.addEventListener('load', () => {
            runFullDiagnostic();
        });
    </script>
</body>
</html>
